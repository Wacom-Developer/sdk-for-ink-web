# Tutorial 4: Selecting strokes

In this tutorial, you will learn how to select strokes. 
The tutorial is divided into the following parts:

* [Part 1: Selecting strokes](#part-1-selecting-strokes)
* [Part 2: Selecting parts of strokes](#part-2-selecting-parts-of-strokes)

Each part builds on the previous part, extending and improving its functionality.

## Prerequisites
This tutorial continues from Tutorial 2: Encoding and decoding strokes.

## Source code
You can find the sample project in the following location:

```HTML and JavaScript: /web/tutorials/Sample4```

---
---
## Part 1: Selecting strokes

In this tutorial, you will extend your WILL configuration to create tools that allow you to select entire strokes or parts of strokes. 
This tutorial builds on the eraser from Part 1 of Tutorial 3: Erasing strokes and the binary deserialization from Part 2 of Tutorial 2: Encoding and decoding strokes.

In Part 1 of this tutorial, you will select whole strokes and change their colors.

### Step 1: Define a stroke selector with a constant width

Define a stroke selector width of 1.25 as follows:

```javascript
var WILL = {
    ...
    strokeWidth: 1.25,
    ...
};
```

### Step 2: Create an array to store selected strokes

To store selected strokes, define a ```strokes``` array in a ```selection``` namespace as follows:

```javascript
var WILL = {
    ...
    selection: {
        strokes: new Array(),
        ...
    },
...
```

### Step 3: Select strokes by checking for intersections

Define a ```select``` method to identify selected strokes.

Use the ```setTargetAsClosedPath``` method of the *Module.Intersector* class to set the target of the intersection to be the area enclosed by the whole path as calculated by the path builder.

Iterate through the stroke model, checking whether intersections exist. 
If an intersection is found, add it to the ```selection``` namespace.

Finally, display the prepared result using the ```show()``` method (defined in the next step).

The code for these steps is as follows:

```javascript
select: function() {
    this.selection.strokes = new Array();

    this.intersector.setTargetAsClosedPath(this.path);

    this.strokes.forEach(function(stroke) {
        if (this.intersector.isIntersectingTarget(stroke))
            this.selection.strokes.push(stroke);
    }, this);

    if (this.selection.strokes.length > 0)
        this.selection.show();
}
```

### Step 4: Manipulate selected strokes and redraw the canvas

Define a ```show``` method to change the color of the selected strokes and redraw the canvas:

```javascript
var WILL = {
    ...
    selection: {
        ...
        show: function() {
            var dirtyArea = null;

            this.strokes.forEach(function(stroke) {
                stroke.color = Module.Color.RED;
                dirtyArea = Module.RectTools.union(dirtyArea, stroke.bounds);
            });

            WILL.redraw(dirtyArea);
        }
    },

    ...

    initInkEngine: function(width, height) {
        ...

        this.brush = new Module.DirectBrush();

        this.pathBuilder = new Module.SpeedPathBuilder();
        this.smoothener = new Module.MultiChannelSmoothener(this.pathBuilder.stride);

        this.strokeRenderer = new Module.StrokeRenderer(this.canvas, this.canvas);
        this.strokeRenderer.configure({brush: this.brush, color: this.color, width: this.strokeWidth});

        this.intersector = new Module.Intersector();
    },

    ...
```

**Note:** You should store temporary strokes on the ```strokesLayer``` layer, but draw final strokes directly on the canvas.

### View sample

* View complete source code
* View sample

---
---
## Part 2: Selecting parts of strokes

In Part 1 of this tutorial, you selected whole strokes; in Part 2, you will select parts of strokes inside a selection area.

### Step 1: Find intersections with strokes

Use the ```intersectWithTarget``` method to find intersections with drawn paths. 
This method returns an array of intervals. 
Each interval of the path is either totally inside or totally outside the intersection target. 
If at least one interval is inside the target, replace the stroke with its substrokes.

### Step 2: Remove the original strokes and create new strokes for every interval

If intervals are inside the target, change their color to red. 

If intervals are outside the target, do not change their color.

When you create the selecting stroke, compare it to the existing strokes on the canvas. 
Iterate through each stroke and use the ```intersectWithTarget``` intersector method with the parameter ```stroke``` to check for intersections between the selecting stroke and the stroke on the canvas. 
If there is an intersection, split the affected stroke and create new strokes from the intervals list. 
When the iteration is complete, replace any intersected strokes with the new strokes generated by the split. 
The ```selection``` namespace recognizes new strokes that are inside the selection and changes their color accordingly. 
After that, redraw the modified zone.

Finally, display the prepared result with the ```show()``` method.

The code for these steps is as follows:

```javascript
var WILL = {
    ...

    select: function() {
        this.selection.strokes = new Array();

        var strokesToRemove = new Array();

        this.intersector.setTargetAsClosedPath(this.path);

        this.strokes.forEach(function(stroke) {
            var intervals = this.intersector.intersectWithTarget(stroke);
            var split = stroke.split(intervals, this.intersector.targetType);

            if (split.intersect) {
                strokesToRemove.push({stroke: stroke, replaceWith: split.strokes, dirtyArea: split.bounds});

                split.selected.forEach(function(stroke) {
                    WILL.selection.strokes.push(stroke);
                }, this);
            }
        }, this);

        strokesToRemove.forEach(function(strokeToRemove) {
            this.strokes.replace(strokeToRemove.stroke, strokeToRemove.replaceWith);
        }, this);

        if (this.selection.strokes.length > 0)
            this.selection.show();
    },

    ...
};

Module.addPostScript(function() {...});
```

### View sample
* View complete source code
* View sample

---
---
